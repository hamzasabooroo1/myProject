<!DOCTYPE html>
<html>
<head>
    <title>Media Gallery</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f9f9f9;
        }

        .navbar {
            background-color: #444;
            color: #fff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h1 {
            font-size: 20px;
        }

        .navbar button {
            background-color: #fff;
            color: #444;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 10px;
        }

        h2 {
            text-align: center;
            margin-top: 20px;
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 20px;
        }

        .media-card {
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 240px;
            text-align: center;
        }

        img, video {
            max-width: 100%;
            max-height: 180px;
            border-radius: 6px;
            object-fit: cover;
        }

        .info {
            font-size: 14px;
            margin-top: 10px;
        }

        .info strong {
            display: block;
            font-size: 16px;
        }

        .actions {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .actions button {
            padding: 5px 10px;
            font-size: 13px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .update-btn {
            background-color: #007bff;
            color: white;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body>

    <!-- Navigation Bar -->
    <div class="navbar">
        <h1>Media Gallery</h1>
        <div>
            <button onclick="fetchMedia()">Refresh</button>
            <button onclick="window.location.href='/user_logout'">Logout</button>
        </div>
    </div>

    <!-- Heading -->
    <h2>Uploaded Media Files</h2>

    <!-- Gallery Container -->
    <div class="gallery" id="mediaGallery">
        <p>Loading media files...</p>
    </div>

<script>
    async function fetchMedia() {
        const token = localStorage.getItem('access');
        const gallery = document.getElementById('mediaGallery');
        gallery.innerHTML = '<p>Loading...</p>';

        try {
            const response = await fetch('http://192.168.11.181:8080/media/media-list-view/', {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });

            gallery.innerHTML = '';  // Clear previous content

            if (!response.ok) {
                gallery.innerHTML = '<p>Failed to fetch media.</p>';
                return;
            }

            const data = await response.json();

            if (!Array.isArray(data) || data.length === 0 || data.message === 'no object to display') {
                gallery.innerHTML = '<p>No media objects to display.</p>';
                return;
            }

            data.forEach(media => {
                const card = document.createElement('div');
                card.className = 'media-card';

                let mediaElement = '';
                if (media.media_type === 'image') {
                    mediaElement = `<img src="${media.file}" alt="${media.title}">`;
                } else if (media.media_type === 'video') {
                    mediaElement = `
                        <video controls>
                            <source src="${media.file}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    `;
                } else {
                    mediaElement = `<a href="${media.file}" target="_blank">Download File</a>`;
                }

                card.innerHTML = `
                    ${mediaElement}
                    <div class="info">
                        <strong>${media.title}</strong>
                        ${media.media_extension}<br>
                        Size: ${(media.media_size / 1024).toFixed(1)} KB
                    </div>
                    <div class="actions">
                        <button class="update-btn" onclick="updateMedia(${media.id})">Update</button>
                        <button class="delete-btn" onclick="deleteMedia(${media.id})">Delete</button>
                    </div>
                `;

                gallery.appendChild(card);
            });

        } catch (error) {
            console.error('Error fetching media:', error);
            gallery.innerHTML = '<p>Error loading media.</p>';
        }
    }

    function updateMedia(id) {
        window.location.href = `/media/media_detail_view_patch/${id}/`;
    }

    async function deleteMedia(id) {
        const confirmDelete = confirm('Are you sure you want to delete this media file?');
        if (!confirmDelete) return;

        const token = localStorage.getItem('access');

        try {
            const response = await fetch(`http://192.168.11.181:8080/media/media-detail-view/${id}/`, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });

            if (response.ok) {
                alert('Media deleted successfully.');
                fetchMedia();  // Refresh list
            } else {
                alert('Failed to delete media. Status: ' + response.status);
            }
        } catch (error) {
            console.error('Delete error:', error);
            alert('Error occurred during delete.');
        }     
    }

    // Initial load
    fetchMedia();
</script>


</body>
</html>
